-- ----------------------------------------------------------------------------------------------------------------------------------------------------------
-- 一、会员列表页

-- 1.页面数据：
-- ReceiptsOrderCustomEntityMapper.getTotalAddNewMemberCount
-- 项目中查询时间：12-16s，数据库中查询时间12-16s
-- SELECT count(*) FROM (SELECT cst_customerId FROM customer_store WHERE cst_sellerId = 769 AND cst_storeId = 839 AND cst_createdTime >= "2019-12-9 0:0:0" AND cst_createdTime <= "2019-12-9 23:59:59" ) AS a; 


-- -------------------------------------------------------------------------------------------------------------------------------------------
-- 三、账目查询页面


-- 1.进入页面慢：数据过多（五个tab，页面数据全部查询出来之后才进入页面,只有这一个sql较慢）
-- ReceiptsOrderCustomEntityMapper.getTotalMarketingOrderMemberCount
-- 项目中执行时间：16.008s，数据库中时间：19.943s
-- SELECT COUNT(distinct reor_customerId) FROM receipts_order WHERE reor_status =3 AND reor_sellerId = 769 AND reor_storeId = 839 AND reor_customerId IS NOT NULL AND reor_totalAmount > reor_actuallyAmount 


-- 2.列表数据（sql是刚才就有，刚刚忘了把方法名写出来）
-- 项目中查询超时，数据库中查询时间：500s都没有出来：
-- ReceiptsOrderCustomEntityMapper.getReceiptsListByConditions
-- 又可以了...项目中时间：13.654s，数据库中查询时间：17.210s
-- select reor_id, reor_sellerId, reor_storeId, reor_customerId, reor_prepaidCardId, reor_serialNumber, reor_description, reor_createdTime, reor_discount, reor_discountInfoId, reor_totalAmount, reor_receivableAmount, reor_otherReceivableAmount, reor_actuallyAmount, reor_discountAmount, reor_preferenceTotalAmount, reor_consumerNumber, reor_gifttokenTotalAmount, reor_gifttokenCount, reor_goodsTotalAmount, reor_goodsDiscountTotalAmount, reor_goodsCount, reor_mergeCardPaymentAmount, reor_mergeExpenseCardPaymentAmount, reor_expenseCardSellerId, reor_eraseAmount, reor_changeAmount, reor_paymentAmount, reor_paymentType, reor_paymentProvider, reor_paymentMessage, reor_paymentTime, reor_authMethod, reor_outTradeId, reor_operatorId, reor_invoiceNo, reor_postscript, reor_status, reor_finishedTime, reor_revokeOperatorId, reor_revokeRemark, reor_revokeTime, reor_updatedTime, reor_lastOperatorId, reor_lastOperatedTime, reor_version, reor_unifiedOrderIds, reor_outSerialNumber, reor_deviceInfo, reor_deviceIpAddr, reor_operatorCode, reor_deviceCode, reor_isPrepaidCardDiscount, reor_channelId, reor_goodsVipPrice, reor_callBackUrl, reor_isCallBackOver, reor_relateOrderId, reor_refundAmount, reor_secretId, reor_preAmount, reor_preDiscount, reor_dpllId , sto_id, sto_sellerId, sto_name, sto_description, sto_logoImageUrl, sto_category, sto_addressDescription, sto_addressDetail, sto_addressLongitude, sto_addressLatitude, sto_geoHash, sto_globalRegionPath, sto_openingHours, sto_mobilePhoneNumber, sto_telephoneNumber, sto_createdTime, sto_updatedTime, sto_regionId, sto_operatorId, sto_stopStatus, sto_stopRemark, sto_auditStatus, sto_auditRemark, sto_validityTime, sto_isOpenMall, sto_viewImageUrls, sto_code, sto_industryCategoryId, sto_isTest, sto_accountingCode , customer1.cus_id as customer1_cus_id, customer1.cus_idNumber as customer1_cus_idNumber, customer1.cus_name as customer1_cus_name, customer1.cus_displayName as customer1_cus_displayName, customer1.cus_realName as customer1_cus_realName, customer1.cus_password as customer1_cus_password, customer1.cus_email as customer1_cus_email, customer1.cus_phoneNumber as customer1_cus_phoneNumber, customer1.cus_gender as customer1_cus_gender, customer1.cus_birthday as customer1_cus_birthday, customer1.cus_qq as customer1_cus_qq, customer1.cus_createdTime as customer1_cus_createdTime, customer1.cus_lastLoginTime as customer1_cus_lastLoginTime, customer1.cus_lastCheckTime as customer1_cus_lastCheckTime, customer1.cus_avatarImageUrl as customer1_cus_avatarImageUrl, customer1.cus_status as customer1_cus_status, customer1.cus_isEnabled as customer1_cus_isEnabled, customer1.cus_token as customer1_cus_token, customer1.cus_token1 as customer1_cus_token1, customer1.cus_token2 as customer1_cus_token2, customer1.cus_salt as customer1_cus_salt, customer1.cus_isRegistered as customer1_cus_isRegistered, customer1.cus_registerDate as customer1_cus_registerDate, customer1.cus_shippingAddress as customer1_cus_shippingAddress, customer1.cus_sellerId as customer1_cus_sellerId, customer1.cus_wxOpenId as customer1_cus_wxOpenId, customer1.cus_wxNickName as customer1_cus_wxNickName, customer1.cus_alipayOpenId as customer1_cus_alipayOpenId, customer1.cus_wxOpenIdForSeller as customer1_cus_wxOpenIdForSeller, customer1.cus_wxAppletOpenId as customer1_cus_wxAppletOpenId, customer1.cus_wxUnionid as customer1_cus_wxUnionid, customer1.cus_wxSubscribed as customer1_cus_wxSubscribed, customer1.cus_wxSubscribedForSeller as customer1_cus_wxSubscribedForSeller, customer1.cus_fromType as customer1_cus_fromType , cemp_id, cemp_sellerId, cemp_storeId, cemp_customerId, cemp_code, cemp_remark, cemp_isAdmin, cemp_postDescription, cemp_isEnabled, cemp_creatorId, cemp_createdTime, cemp_lastVisitTime, cemp_lastVisitIp, cemp_lastVisitDevice, cemp_lastVisitCount, cemp_bindDeviceId, cemp_bindDeviceName, cemp_updateTime, cemp_isPushMsg, cemp_role, cemp_pushMsg, cemp_referrerId, cemp_name , seller1.sel_id as seller1_sel_id, seller1.sel_identifier as seller1_sel_identifier, seller1.sel_displayName as seller1_sel_displayName, seller1.sel_description as seller1_sel_description, seller1.sel_industryCategoryId as seller1_sel_industryCategoryId, seller1.sel_contactsName as seller1_sel_contactsName, seller1.sel_contactsIdCardNumber as seller1_sel_contactsIdCardNumber, seller1.sel_contactsIdCardImageUrl as seller1_sel_contactsIdCardImageUrl, seller1.sel_contactsIdCardImageUrl1 as seller1_sel_contactsIdCardImageUrl1, seller1.sel_contactsPhoneNumber as seller1_sel_contactsPhoneNumber, seller1.sel_contactsEmail as seller1_sel_contactsEmail, seller1.sel_telephone as seller1_sel_telephone, seller1.sel_legalPersonName as seller1_sel_legalPersonName, seller1.sel_legalPersonIDCardNumber as seller1_sel_legalPersonIDCardNumber, seller1.sel_legalPersonIDCardImageUrl as seller1_sel_legalPersonIDCardImageUrl, seller1.sel_legalPersonIDCardImageUrl1 as seller1_sel_legalPersonIDCardImageUrl1, seller1.sel_licenseNumber as seller1_sel_licenseNumber, seller1.sel_licenseImageUrl as seller1_sel_licenseImageUrl, seller1.sel_proxyLetterImageUrl as seller1_sel_proxyLetterImageUrl, seller1.sel_createdTime as seller1_sel_createdTime, seller1.sel_updatedTime as seller1_sel_updatedTime, seller1.sel_isEnabled as seller1_sel_isEnabled, seller1.sel_isAudit as seller1_sel_isAudit, seller1.sel_auditTime as seller1_sel_auditTime, seller1.sel_auditReason as seller1_sel_auditReason, seller1.sel_auditPerson as seller1_sel_auditPerson, seller1.sel_auditSubmitTime as seller1_sel_auditSubmitTime, seller1.sel_industryPath as seller1_sel_industryPath, seller1.sel_globalRegionPath as seller1_sel_globalRegionPath, seller1.sel_storeCount as seller1_sel_storeCount, seller1.sel_storeCountLimit as seller1_sel_storeCountLimit, seller1.sel_creatorId as seller1_sel_creatorId, seller1.sel_servicePersonName as seller1_sel_servicePersonName, seller1.sel_marketPersonName as seller1_sel_marketPersonName, seller1.sel_appId as seller1_sel_appId, seller1.sel_mchId as seller1_sel_mchId, seller1.sel_remark as seller1_sel_remark, seller1.sel_tag as seller1_sel_tag, seller1.sel_enterpriseName as seller1_sel_enterpriseName, seller1.sel_expiryDateFrom as seller1_sel_expiryDateFrom, seller1.sel_expiryDateTo as seller1_sel_expiryDateTo, seller1.sel_settingId as seller1_sel_settingId, seller1.sel_payChannel as seller1_sel_payChannel, seller1.sel_exMerchtNm as seller1_sel_exMerchtNm, seller1.sel_registAddr as seller1_sel_registAddr, seller1.sel_cooperationId as seller1_sel_cooperationId, seller1.sel_saleManPhoneNumber as seller1_sel_saleManPhoneNumber , CONCAT(operator.cus_phoneNumber,'(', cemp_name, ')') as operatorName, (CASE WHEN revoke_operator.cus_realName is NULL THEN revoke_operator.cus_phoneNumber ELSE CONCAT(revoke_operator.cus_phoneNumber,'(', revoke_operator.cus_realName, ')') END ) as revokeOperatorName, (CASE WHEN last_operator.cus_realName is NULL THEN last_operator.cus_phoneNumber ELSE CONCAT(last_operator.cus_phoneNumber,'(', last_operator.cus_realName, ')') END ) as lastOperatorName, (CASE WHEN ecd_prepaidCardName is NULL THEN CONCAT(seller2.sel_displayName,'储值卡') ELSE ecd_prepaidCardName END ) AS userExpenseCardName, cst_tradeNumber AS customerOrderCount, operator.cus_phoneNumber AS operatorPhone from receipts_order left join store on sto_id=reor_storeId left join customer as customer1 on reor_customerId=customer1.cus_id left join customer as operator on operator.cus_id=reor_operatorId left join customer_employee on cemp_customerId=reor_operatorId AND cemp_sellerId =reor_sellerId AND (cemp_storeId = reor_storeId or cemp_isAdmin = 1) left join customer as revoke_operator on revoke_operator.cus_id=reor_revokeOperatorId left join customer as last_operator on last_operator.cus_id=reor_lastOperatorId left join seller as seller2 on seller2.sel_id=reor_expenseCardSellerId left join seller as seller1 on seller1.sel_id=reor_sellerId left join expense_card_def on ecd_sellerId=reor_expenseCardSellerId left join customer_store on cst_customerId=reor_customerId AND cst_sellerId = reor_sellerId AND cst_storeId = reor_storeId WHERE ( reor_sellerId = 769 and reor_storeId = 839 and reor_status <> 1 and reor_status <> 126 and reor_status <> 125 ) order by reor_finishedTime DESC limit 0 , 15 





-- ----------------------------------------------------------------------------------------------------------------------------------------------------------------
-- 六、店员业绩页面（该页面，页面数据为每次与页面列表一起加载）

-- ReceiptsOrderCustomEntityMapper.getReceiptsListTotalAmount
-- 项目中查询时间： 47.057s，数据库中查询时间：38.487s（这个一直都比较慢）
-- select SUM(reor_totalAmount) from receipts_order WHERE ( reor_sellerId = 769 and reor_storeId = 839 and reor_finishedTime between "2019-12-1 0:0:0" and "2019-12-6 16:53:48" and reor_operatorId is null ) 
